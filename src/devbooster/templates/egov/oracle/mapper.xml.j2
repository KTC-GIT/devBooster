{# src/devbooster/templates/egov/oracle/mapper.xml.j2 #}

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="egovframework.{{ module }}.service.impl.{{ class_name }}Mapper">

    <!-- ResultMap: {{ table_name }}-->
    <resultMap id="{{ class_name }}Result" type="{{ class_name }}VO">
        {% for col in columns %}
        <result property="{{ col.name | camel }}" column="{{ col.name }}"/>
        {% endfor %}
    </resultMap>

    <!-- 목록 조회 -->
    <select id="select{{ class_name }}List" resultMap="{{ class_name }}Result">
        SELECT /** IDNEX_DESC({{ table_name }} PK_{{ table_name }}) */
        {% for col in columns %}
            {{ col.name }}{% if not loop.last %}, {% endif %}
        {% endfor %}
        FROM {{ table_name }}
        WHERE 1=1
        {% if has_use_yn %}
        AND USE_YN = 'Y'
        {% endif %}
        {% if has_del_yn %}
        AND DEL_YN = 'N'
        {% endif %}
        ORDER BY {% for id_col in identifier %}{{ id_col }}{% if not loop.last %}, {% endif %}{% endfor %} DESC
    </select>

    <!-- 상세 조회 -->
    <select id="select{{ class_name }}" resultMap="{{ class_name }}Result">
        SELECT
        {% for col in columns %}
            {{ col.name }}{% if not loop.last %}, {% endif %}
        {% endfor %}
        FROM {{ table_name }}
        WHERE {% for id_col in identifier %}{{ id_col }} = #{{ '{' }}{{ id_col | camel }}{{ '}' }}{% if not loop.last %}
        AND {% endif %}{% endfor %}
        {% if has_use_yn %}
        AND USE_YN = 'Y'
        {% endif %}
    </select>

    <!-- 등록 -->
    <insert id="insert{{ class_name }}">
        INSERT INTO {{ table_name }} (
        {% for col in columns %}
            {{ col.name }}{% if not loop.last %},{% endif %}
        {% endfor %}
        ) VALUES (
        {% for col in columns %}
            #{{ '{' }}{{ col.name | camel }}{{ '}' }}{%  if not loop.last %},{% endif %}
        {% endfor %}
        )
    </insert>

    <!-- 수정 -->
    <update id="update{{ class_name }}">
        UPDATE {{ table_name }}
        SET
        {% for col in columns if col.name not in identifier %}
            {{ col.name }} = #{{ '{' }}{{ col.name | camel }}{{ '}' }}{% if not loop.last %},{% endif %}
        {% endfor %}
        WHERE {% for id_col in identifier %}{{ id_col }} = #{{ '{' }}{{ id_col | camel }}{{ '}' }}{% if not loop.last %}
        AND {% endif %}{% endfor %}
    </update>

    <!-- 삭제 -->
    {% if logical_delete %}
    <update id="delete{{ class_name }}">
        UPDATE {{ table_name }}
        SET {% if has_use_yn %}USE_YN = 'N'{% elif has_del_yn %}DEL_YN = 'Y'{% endif %}
        WHERE {% for id_col in identifier %}{{ id_col }} = #{{ '{' }}{{ id_col | camel }}{{ '}' }}{% if not loop.last %}
        AND {% endif %}{% endfor %}
    </update>
    {% else %}
    <delete id="delete{{ class_name }}">
        DELETE FROM {{ table_name }}
        WHERE {% for id_col in identifier %}{{ id_col }} = #{{ '{' }}{{ id_col | camel }}{{ '}' }}{% if not loop.last %}
        AND {% endif %}{% endfor %}
    </delete>
    {% endif %}
</mapper>